CREATE SCHEMA SPOPOFF AUTHORIZATION SA;
CREATE TABLE SPOPOFF.IDNT_ATTRS (FKIDNT INTEGER ,ATTR VARCHAR( 10 ) ,VAL VARCHAR( 150 ) ,PKATTR_IDNT INTEGER ,PRIMARY KEY ( PKATTR_IDNT ));
CREATE TABLE SPOPOFF.CPTE_ATTRS (FKCPTE INTEGER NOT NULL ,ATTR VARCHAR( 10 ) NOT NULL ,VAL VARCHAR( 150 ) NOT NULL ,PKATTR_CPTE INTEGER NOT NULL  ,PRIMARY KEY ( PKATTR_CPTE ));
CREATE TABLE SPOPOFF.OBJS_ATTRS (FKOBJS INTEGER NOT NULL ,ATTR VARCHAR( 10 ) NOT NULL ,VAL VARCHAR( 150 ) NOT NULL ,PKATTR_OBJS INTEGER NOT NULL  ,PRIMARY KEY ( PKATTR_OBJS ));
CREATE TABLE SPOPOFF.IDENTITE (PKIDNT INTEGER NOT NULL ,USERNAME VARCHAR( 30 ) NOT NULL ,FONCTION VARCHAR( 30 ) NOT NULL ,DEPARTEMENT VARCHAR( 30 ) NOT NULL, PRIMARY KEY ( PKIDNT ));
CREATE TABLE SPOPOFF.COMPTE (PKCPTE INTEGER NOT NULL ,PKCPTE2 INTEGER NOT NULL , PRIMARY KEY ( PKCPTE ) );
CREATE TABLE SPOPOFF.HABILITANT (PKHBLT INTEGER NOT NULL ,VAL VARCHAR( 100 ) NOT NULL ,TYPE INTEGER , PRIMARY KEY ( PKHBLT ));
CREATE TABLE SPOPOFF.OBJSECU (PKOBJS INTEGER NOT NULL , PRIMARY KEY ( PKOBJS ));
CREATE TABLE SPOPOFF.OBJS_HBLT (FKOBJS INTEGER NOT NULL ,FKHBLT INTEGER NOT NULL ,PKOBJS_HBLT INTEGER auto_increment NOT NULL  , PRIMARY KEY ( PKOBJS_HBLT ));
CREATE TABLE SPOPOFF.OBJS_CPTE (FKOBJS INTEGER NOT NULL ,FKCPTE INTEGER NOT NULL ,PKOBJS_CPTE INTEGER auto_increment NOT NULL  , PRIMARY KEY ( PKOBJS_CPTE ));
CREATE TABLE SPOPOFF.IDNT_CPTE (FKIDNT INTEGER NOT NULL ,FKCPTE INTEGER NOT NULL ,PKIDNT_CPTE INTEGER NOT NULL  , PRIMARY KEY ( PKIDNT_CPTE ));
CREATE TABLE SPOPOFF.CPTE_HBLT (FKCPTE INTEGER NOT NULL ,FKHBLT INTEGER NOT NULL ,PKCPTE_HBLT INTEGER NOT NULL  , PRIMARY KEY ( PKCPTE_HBLT ));
ALTER TABLE SPOPOFF.IDNT_ATTRS ADD CONSTRAINT AA1234 FOREIGN KEY (FKIDNT) REFERENCES SPOPOFF.IDENTITE (PKIDNT);
ALTER TABLE SPOPOFF.CPTE_ATTRS ADD CONSTRAINT AB1234 FOREIGN KEY (FKCPTE) REFERENCES SPOPOFF.COMPTE (PKCPTE);
ALTER TABLE SPOPOFF.OBJS_ATTRS ADD CONSTRAINT AC1234 FOREIGN KEY (FKOBJS) REFERENCES SPOPOFF.OBJSECU (PKOBJS);
ALTER TABLE SPOPOFF.OBJS_HBLT ADD CONSTRAINT AD1234 FOREIGN KEY (FKOBJS) REFERENCES SPOPOFF.OBJSECU (PKOBJS);
ALTER TABLE SPOPOFF.OBJS_HBLT ADD CONSTRAINT AE1234 FOREIGN KEY (FKHBLT) REFERENCES SPOPOFF.HABILITANT (PKHBLT);
ALTER TABLE SPOPOFF.OBJS_CPTE ADD CONSTRAINT AF1234 FOREIGN KEY (FKOBJS) REFERENCES SPOPOFF.OBJSECU (PKOBJS);
ALTER TABLE SPOPOFF.OBJS_CPTE ADD CONSTRAINT AG1234 FOREIGN KEY (FKCPTE) REFERENCES SPOPOFF.COMPTE (PKCPTE);
ALTER TABLE SPOPOFF.IDNT_CPTE ADD CONSTRAINT AH1234 FOREIGN KEY (FKIDNT) REFERENCES SPOPOFF.IDENTITE (PKIDNT);
ALTER TABLE SPOPOFF.IDNT_CPTE ADD CONSTRAINT AI1234 FOREIGN KEY (FKCPTE) REFERENCES SPOPOFF.COMPTE (PKCPTE);
ALTER TABLE SPOPOFF.CPTE_HBLT ADD CONSTRAINT AJ1234 FOREIGN KEY (FKHBLT) REFERENCES SPOPOFF.HABILITANT (PKHBLT);
ALTER TABLE SPOPOFF.CPTE_HBLT ADD CONSTRAINT AK1234 FOREIGN KEY (FKCPTE) REFERENCES SPOPOFF.COMPTE (PKCPTE);

CREATE TABLE SPOPOFF.Members (pkMember INTEGER NOT NULL,fkIdentity INTEGER NOT NULL,fkRole INTEGER NOT NULL, CONSTRAINT MembersPrimaryK PRIMARY KEY(pkMember));
CREATE TABLE SPOPOFF.Permissions ( pkPermissions INTEGER NOT NULL,fkRole INTEGER NOT NULL,active SMALLINT NOT NULL DEFAULT 1,fkHabilitant INTEGER NOT NULL, CONSTRAINT PermissionPrimaryK PRIMARY KEY(pkPermissions));
CREATE TABLE SPOPOFF.Role (pkRole INTEGER NOT NULL,name VARCHAR(25) NOT NULL,type SMALLINT NOT NULL DEFAULT 0,haveChild SMALLINT NOT NULL DEFAULT 0,active SMALLINT NOT NULL DEFAULT 1,CONSTRAINT RolePrimaryK PRIMARY KEY(pkRole));
CREATE TABLE SPOPOFF.RolesLink ( pkRoleLink INTEGER NOT NULL,fkParentRole INTEGER NOT NULL,fkChildRole INTEGER NOT NULL,active SMALLINT NOT NULL DEFAULT 1,CONSTRAINT RoleLinkPrimaryK PRIMARY KEY(pkRoleLink));
CREATE TABLE SPOPOFF.Groupe (pkGroupe INTEGER NOT NULL,name VARCHAR(25) NOT NULL,type SMALLINT NOT NULL DEFAULT 0,haveChild SMALLINT NOT NULL DEFAULT 0,active SMALLINT NOT NULL DEFAULT 1,CONSTRAINT GroupePrimaryK PRIMARY KEY(pkGroupe));
CREATE TABLE SPOPOFF.MemberOf (pkMemberOf INTEGER NOT NULL,fkIdentity INTEGER ,fkGroupe INTEGER NOT NULL, fkGroupeNested INTEGER , CONSTRAINT MembersOfPrimaryK PRIMARY KEY(pkMemberOf));
ALTER TABLE SPOPOFF.RolesLink ADD CONSTRAINT RoleLinkUnique UNIQUE (fkParentRole, fkChildRole);
ALTER TABLE SPOPOFF.RolesLink ADD CONSTRAINT Child FOREIGN KEY(fkChildRole) REFERENCES SPOPOFF.Role(pkRole);
ALTER TABLE SPOPOFF.RolesLink ADD CONSTRAINT Parent FOREIGN KEY(fkParentRole) REFERENCES SPOPOFF.Role(pkRole);
ALTER TABLE SPOPOFF.Members ADD CONSTRAINT HaveRole FOREIGN KEY(fkRole) REFERENCES SPOPOFF.Role(pkRole);
ALTER TABLE SPOPOFF.Permissions ADD CONSTRAINT HavePermission FOREIGN KEY(fkRole) REFERENCES SPOPOFF.Role(pkRole);
ALTER TABLE SPOPOFF.MemberOf ADD CONSTRAINT HaveGroupe FOREIGN KEY(fkGroupe) REFERENCES SPOPOFF.Groupe(pkGroupe);
ALTER TABLE SPOPOFF.MemberOf ADD CONSTRAINT HaveNestedGroupe FOREIGN KEY(fkGroupeNested) REFERENCES SPOPOFF.Groupe(pkGroupe);
ALTER TABLE SPOPOFF.MemberOf ADD CONSTRAINT HaveMember FOREIGN KEY(fkIdentity) REFERENCES SPOPOFF.IDENTITE(PKIDNT);

CREATE TABLE SPOPOFF.DPT_IDNT_CPTE (PKDPT_IDNT_CPTE INTEGER NOT NULL, FKIDNT INTEGER NOT NULL, FKCPTE INTEGER,USERNAME VARCHAR( 30 ) ,FONCTION VARCHAR( 30 ) , DEPARTEMENT VARCHAR( 30 ) NOT NULL, NB_IDNT INTEGER, NB_CPTE INTEGER, PRIMARY KEY ( PKDPT_IDNT_CPTE ));
CREATE TABLE SPOPOFF.DPT (DEPARTEMENT VARCHAR( 30 ) NOT NULL, PRIMARY KEY ( DEPARTEMENT ));
